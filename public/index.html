<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Texas Hold'em Poker</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #0f3d2c;
            color: white;
        }
        
        .poker-table {
            background: #1a5e3a;
            border-radius: 50%;
            width: 600px;
            height: 400px;
            margin: 0 auto;
            position: relative;
            border: 8px solid #8B4513;
        }
        
        .community-cards {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            gap: 10px;
        }
        
        .card {
            width: 50px;
            height: 70px;
            background: white;
            color: black;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 12px;
            box-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .player-positions {
            position: relative;
            width: 100%;
            height: 100%;
        }
        
        .player {
            position: absolute;
            background: rgba(255,255,255,0.1);
            padding: 10px;
            border-radius: 8px;
            min-width: 120px;
            text-align: center;
        }
        
        .player.current {
            background: rgba(255,255,0,0.3);
            border: 2px solid yellow;
        }
        
        .player.folded {
            opacity: 0.5;
        }
        
        .player-name {
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .player-chips {
            font-size: 12px;
            color: #90EE90;
        }
        
        .player-cards {
            display: flex;
            gap: 5px;
            justify-content: center;
            margin: 5px 0;
        }
        
        .player-cards .card {
            width: 30px;
            height: 42px;
            font-size: 10px;
        }
        
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        
        .controls button {
            margin: 0 10px;
            padding: 10px 20px;
            font-size: 16px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        
        .controls button:hover {
            background: #45a049;
        }
        
        .controls button:disabled {
            background: #666;
            cursor: not-allowed;
        }
        
        .game-info {
            text-align: center;
            margin: 20px 0;
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 8px;
        }
        
        .join-form {
            text-align: center;
            margin: 20px 0;
        }
        
        .join-form input {
            padding: 10px;
            margin: 0 10px;
            border: none;
            border-radius: 5px;
        }
        
        .raise-input {
            margin: 0 10px;
            padding: 5px;
            width: 100px;
        }
        
        /* Position players around the table */
        .player:nth-child(1) { top: -50px; left: 50%; transform: translateX(-50%); }
        .player:nth-child(2) { top: 20px; right: -100px; }
        .player:nth-child(3) { bottom: 20px; right: -100px; }
        .player:nth-child(4) { bottom: -50px; left: 50%; transform: translateX(-50%); }
        .player:nth-child(5) { bottom: 20px; left: -100px; }
        .player:nth-child(6) { top: 20px; left: -100px; }
    </style>
</head>
<body>
    <h1>Texas Hold'em Poker</h1>
    
    <div id="join-section" class="join-form">
        <input type="text" id="player-name" placeholder="Enter your name" />
        <input type="text" id="game-id" placeholder="Game ID (optional)" />
        <button onclick="joinGame()">Join Game</button>
    </div>
    
    <div id="game-section" style="display: none;">
        <div class="game-info">
            <div>Pot: $<span id="pot">0</span></div>
            <div>Current Bet: $<span id="current-bet">0</span></div>
            <div>Game State: <span id="game-state">waiting</span></div>
            <div>Betting Round: <span id="betting-round">-</span></div>
        </div>
        
        <div class="poker-table">
            <div class="community-cards" id="community-cards"></div>
            <div class="player-positions" id="players"></div>
        </div>
        
        <div class="controls">
            <button id="fold-btn" onclick="playerAction('fold')" disabled>Fold</button>
            <button id="check-btn" onclick="playerAction('check')" disabled>Check</button>
            <button id="call-btn" onclick="playerAction('call')" disabled>Call</button>
            <input type="number" id="raise-amount" class="raise-input" placeholder="Amount" min="1" />
            <button id="raise-btn" onclick="playerAction('raise')" disabled>Raise</button>
        </div>
        
        <div id="your-cards" class="game-info">
            <div>Your Cards:</div>
            <div id="hand-cards" style="display: flex; justify-content: center; gap: 10px; margin-top: 10px;"></div>
        </div>
    </div>
    
    <script>
        let socket;
        let gameState = {};
        let myPlayerId;
        
        function joinGame() {
            const playerName = document.getElementById('player-name').value.trim();
            const gameId = document.getElementById('game-id').value.trim() || 'default';
            
            if (!playerName) {
                alert('Please enter your name');
                return;
            }
            
            socket = io();
            // @TODO: this needs to be handled differently in case of a hangup
            myPlayerId = socket.id;
            
            socket.emit('join-game', { gameId, playerName });
            
            socket.on('joined-game', (data) => {
                if (data.success) {
                    document.getElementById('join-section').style.display = 'none';
                    document.getElementById('game-section').style.display = 'block';
                } else {
                    // @todo:  this needs to be handled
                    console.error('Failed to join game: ' + data.error);
                }
            });
            
            socket.on('game-update', (data) => {
                gameState = data;
                updateGameDisplay();
            });
        }
        
        function updateGameDisplay() {
            // Update game info
            document.getElementById('pot').textContent = gameState.pot;
            document.getElementById('current-bet').textContent = gameState.currentBet;
            document.getElementById('game-state').textContent = gameState.gameState;
            document.getElementById('betting-round').textContent = gameState.bettingRound;
            
            // Update community cards
            const communityCardsDiv = document.getElementById('community-cards');
            communityCardsDiv.innerHTML = '';
            gameState.communityCards.forEach(card => {
                const cardDiv = document.createElement('div');
                cardDiv.className = 'card';
                cardDiv.textContent = card;
                communityCardsDiv.appendChild(cardDiv);
            });
            
            // Update players
            const playersDiv = document.getElementById('players');
            playersDiv.innerHTML = '';
            gameState.players.forEach((player, index) => {
                const playerDiv = document.createElement('div');
                playerDiv.className = 'player';
                
                if (index === gameState.currentPlayerIndex && gameState.gameState === 'betting') {
                    playerDiv.classList.add('current');
                }
                
                if (player.folded) {
                    playerDiv.classList.add('folded');
                }
                
                playerDiv.innerHTML = `
                    <div class="player-name">${player.name}</div>
                    <div class="player-chips">$${player.chips}</div>
                    <div class="player-chips">Bet: $${player.currentBet}</div>
                    <div class="player-cards">
                        ${player.id === socket.id ? 
                            player.hand.map(card => `<div class="card">${card}</div>`).join('') :
                            '<div class="card">??</div><div class="card">??</div>'
                        }
                    </div>
                `;
                
                playersDiv.appendChild(playerDiv);
            });
            
            // Update your hand cards
            const myPlayer = gameState.players.find(p => p.id === socket.id);
            if (myPlayer) {
                const handCardsDiv = document.getElementById('hand-cards');
                handCardsDiv.innerHTML = '';
                myPlayer.hand.forEach(card => {
                    const cardDiv = document.createElement('div');
                    cardDiv.className = 'card';
                    cardDiv.textContent = card;
                    handCardsDiv.appendChild(cardDiv);
                });
            }
            
            // Update buttons
            updateButtons();
        }
        
        function updateButtons() {
            const isMyTurn = gameState.players[gameState.currentPlayerIndex]?.id === socket.id;
            const isBetting = gameState.gameState === 'betting';
            const myPlayer = gameState.players.find(p => p.id === socket.id);
            
            const canAct = isMyTurn && isBetting && myPlayer && !myPlayer.folded;
            
            document.getElementById('fold-btn').disabled = !canAct;
            document.getElementById('check-btn').disabled = !canAct || myPlayer?.currentBet !== gameState.currentBet;
            document.getElementById('call-btn').disabled = !canAct || myPlayer?.currentBet === gameState.currentBet;
            document.getElementById('raise-btn').disabled = !canAct;
            
            // Update call button text
            if (myPlayer && gameState.currentBet > myPlayer.currentBet) {
                const callAmount = Math.min(gameState.currentBet - myPlayer.currentBet, myPlayer.chips);
                document.getElementById('call-btn').textContent = `Call $${callAmount}`;
            } else {
                document.getElementById('call-btn').textContent = 'Call';
            }
        }
        
        function playerAction(action) {
            if (!socket) {
                // @todo: this needs to be handled
                console.log("There is no socket");
                return;
            };
            
            let amount = 0;
            if (action === 'raise') {
                amount = parseInt(document.getElementById('raise-amount').value) || 0;
                if (amount <= 0) {
                    alert('Please enter a valid raise amount');
                    return;
                }
            }
            
            socket.emit('player-action', { action, amount });
            // Clear the input after raising
            document.getElementById('raise-amount').value = "";
        }
    </script>
</body>
</html>